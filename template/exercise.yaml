- binary_sensor:
    - name: bike_goal_met_today
      state: "{{ (states('sensor.bike_mileage_today') | float) >= (states('sensor.required_bike_mileage_for_today') | float) }}"
    - name: lifting_goal_met_today
      state: >-
        {% if is_state('calendar.next_lifting', 'on') %}
          {{ states('sensor.lifting_sessions_today')|int >= 1}}
        {% else %}
          on
        {% endif %}
    - name: run_goal_met_today
      state: "{{ (states('sensor.run_mileage_today') | float) >= (states('sensor.required_run_mileage_for_today') | float) }}"
    - name: steps_goal_met_today
      state: "{{ (states('sensor.steps_today') | int) >= (states('sensor.step_goal_today') | int) }}"
    - name: walk_goal_met_today
      state: "{{ (states('sensor.walk_mileage_today') | float) >= (states('sensor.required_walk_mileage_for_today') | float) }}"

- sensor:
    - name: required_run_mileage_for_today
      state: >-
        {% if state_attr('calendar.next_run', 'start_time') and state_attr('calendar.next_run', 'start_time').split()[0] == now().strftime("%Y-%m-%d") %}
          {{ state_attr('calendar.next_run', 'message').split()[0] }}
        {% else %}
          0
        {% endif %}
    - name: required_bike_mileage_for_today
      state: >-
        {% if state_attr('calendar.next_bike', 'start_time') and state_attr('calendar.next_bike', 'start_time').split()[0] == now().strftime("%Y-%m-%d") %}
          {{ state_attr('calendar.next_bike', 'message').split()[0] }}
        {% else %}
          0
        {% endif %}
    - name: required_walk_mileage_for_today
      state: >-
        {% if state_attr('calendar.next_walk', 'start_time') and state_attr('calendar.next_walk', 'start_time').split()[0] == now().strftime("%Y-%m-%d") %}
          {{ state_attr('calendar.next_walk', 'message').split()[0] }}
        {% else %}
          0
        {% endif %}

- trigger:
    - platform: webhook
      webhook_id: ${HASS-GARMIN-WEBHOOK-TOKEN}_01
  sensor: &sensor
    - unique_id: garmin_challenge_01
      name: "{{ trigger.json.name if 'name' in trigger.json else '' }}"
      state: "{{ trigger.json.state if 'state' in trigger.json else '' }}"
      picture: "{{ trigger.json.image_url if 'image_url' in trigger.json else '' }}"
      icon: "{{ trigger.json.icon if 'icon' in trigger.json else '' }}"
      attributes: 
        start_date: "{{ trigger.json.start_date if 'start_date' in trigger.json else '' }}"
        end_date: "{{ trigger.json.end_date if 'end_date' in trigger.json else '' }}"
        description: "{{ trigger.json.description if 'description' in trigger.json else '' }}"
        current_progress: "{{ trigger.json.current_progress if 'current_progress' in trigger.json else '' }}"
        goal: "{{ trigger.json.goal if 'goal' in trigger.json else '' }}"
        units: "{{ trigger.json.units if 'units' in trigger.json else '' }}"
        user: "{{ trigger.json.user if 'user' in trigger.json else '' }}"
        activity_type: "{{ trigger.json.activity_type if 'activity_type' in trigger.json else '' }}"
        type: "{{ trigger.json.type if 'type' in trigger.json else '' }}"
        current_progress_display: "{{ trigger.json.current_progress_display if 'current_progress_display' in trigger.json else '' }}"
        progress_raw: "{{ trigger.json.progress_raw if 'progress_raw' in trigger.json else '' }}"
        url: "{{ trigger.json.url if 'url' in trigger.json else '' }}"

- trigger:
    - platform: webhook
      webhook_id: ${HASS-GARMIN-WEBHOOK-TOKEN}_02
  sensor: 
    - <<: *sensor
      unique_id: garmin_challenge_02

- trigger:
    - platform: webhook
      webhook_id: ${HASS-GARMIN-WEBHOOK-TOKEN}_03
  sensor:
    - <<: *sensor
      unique_id: garmin_challenge_03

- trigger:
    - platform: webhook
      webhook_id: ${HASS-GARMIN-WEBHOOK-TOKEN}_04
  sensor:
    - <<: *sensor
      unique_id: garmin_challenge_04

- trigger:
    - platform: webhook
      webhook_id: ${HASS-GARMIN-WEBHOOK-TOKEN}_05
  sensor:
    - <<: *sensor
      unique_id: garmin_challenge_05

- trigger:
    - platform: webhook
      webhook_id: ${HASS-GARMIN-WEBHOOK-TOKEN}_06
  sensor:
    - <<: *sensor
      unique_id: garmin_challenge_06

- trigger:
    - platform: webhook
      webhook_id: ${HASS-GARMIN-WEBHOOK-TOKEN}_07
  sensor:
    - <<: *sensor
      unique_id: garmin_challenge_07

- trigger:
    - platform: webhook
      webhook_id: ${HASS-GARMIN-WEBHOOK-TOKEN}_08
  sensor:
    - <<: *sensor
      unique_id: garmin_challenge_08

- trigger:
    - platform: webhook
      webhook_id: ${HASS-GARMIN-WEBHOOK-TOKEN}_09
  sensor:
    - <<: *sensor
      unique_id: garmin_challenge_09

- trigger:
    - platform: webhook
      webhook_id: ${HASS-GARMIN-WEBHOOK-TOKEN}_10
  sensor:
    - <<: *sensor
      unique_id: garmin_challenge_10

- trigger:
    - platform: webhook
      webhook_id: ${HASS-GARMIN-WEBHOOK-TOKEN}_11
  sensor:
    - <<: *sensor
      unique_id: garmin_challenge_11

- trigger:
    - platform: webhook
      webhook_id: ${HASS-GARMIN-WEBHOOK-TOKEN}_12
  sensor:
    - <<: *sensor
      unique_id: garmin_challenge_12

- trigger:
    - platform: webhook
      webhook_id: ${HASS-GARMIN-WEBHOOK-TOKEN}_13
  sensor:
    - <<: *sensor
      unique_id: garmin_challenge_13

- trigger:
    - platform: webhook
      webhook_id: ${HASS-GARMIN-WEBHOOK-TOKEN}_14
  sensor:
    - <<: *sensor
      unique_id: garmin_challenge_14

- trigger:
    - platform: webhook
      webhook_id: ${HASS-GARMIN-WEBHOOK-TOKEN}_15
  sensor:
    - <<: *sensor
      unique_id: garmin_challenge_15