- sensor:
    - name: vacuum_next_room_to_clean
      state: >-
        {% set clean_this = namespace(entity='none',last_cleaned='') %}
        {% for state in states.input_datetime %}
          {% if 'vacuum' in state.entity_id %}
            {% set room_enabled = is_state(state.entity_id.replace('datetime', 'boolean').replace('last_cleaned', 'enable'), 'on') %}
            {% set room_cleaned_today = is_state(state.entity_id.replace('datetime', 'boolean').replace('last_cleaned', 'cleaned_today'), 'on') %}
            {% set state_date = strptime(state.state, '%Y-%m-%d %H-%M-%S') %}
            {% if room_enabled and not room_cleaned_today and (clean_this.entity == 'none' or state_date < clean_this.last_cleaned) %}
              {% set clean_this.entity = state.entity_id %}
              {% set clean_this.last_cleaned = state_date %}
            {% endif %}
          {% endif %}
        {% endfor %}
        {{ clean_this.entity.replace('input_datetime.vacuum_', '').replace('_last_cleaned', '') }}
- binary_sensor:
    - name: vacuum_gameroom_16_cleaned_today
      state: "{{ states('input_boolean.vacuum_gameroom_16_cleaned_today') }}"
      icon: "{{ 'mdi:checkbox-marked-circle' if is_state('input_boolean.vacuum_gameroom_16_cleaned_today', 'on') else 'mdi:checkbox-blank-circle'}}"
    - name: vacuum_hallway_17_cleaned_today
      state: "{{ states('input_boolean.vacuum_hallway_17_cleaned_today') }}"
      icon: "{{ 'mdi:checkbox-marked-circle' if is_state('input_boolean.vacuum_hallway_17_cleaned_today', 'on') else 'mdi:checkbox-blank-circle'}}"
    - name: vacuum_bedroom_18_cleaned_today
      state: "{{ states('input_boolean.vacuum_bedroom_18_cleaned_today') }}"
      icon: "{{ 'mdi:checkbox-marked-circle' if is_state('input_boolean.vacuum_bedroom_18_cleaned_today', 'on') else 'mdi:checkbox-blank-circle'}}"
    - name: vacuum_livingroom_19_cleaned_today
      state: "{{ states('input_boolean.vacuum_livingroom_19_cleaned_today') }}"
      icon: "{{ 'mdi:checkbox-marked-circle' if is_state('input_boolean.vacuum_livingroom_19_cleaned_today', 'on') else 'mdi:checkbox-blank-circle'}}"
    - name: vacuum_kitchen_20_cleaned_today
      state: "{{ states('input_boolean.vacuum_kitchen_20_cleaned_today') }}"
      icon: "{{ 'mdi:checkbox-marked-circle' if is_state('input_boolean.vacuum_kitchen_20_cleaned_today', 'on') else 'mdi:checkbox-blank-circle'}}"
    - name: vacuum_diningroom_21_cleaned_today
      state: "{{ states('input_boolean.vacuum_diningroom_21_cleaned_today') }}"
      icon: "{{ 'mdi:checkbox-marked-circle' if is_state('input_boolean.vacuum_diningroom_21_cleaned_today', 'on') else 'mdi:checkbox-blank-circle'}}"
    - name: vacuum_office_22_cleaned_today
      state: "{{ states('input_boolean.vacuum_office_22_cleaned_today') }}"
      icon: "{{ 'mdi:checkbox-marked-circle' if is_state('input_boolean.vacuum_office_22_cleaned_today', 'on') else 'mdi:checkbox-blank-circle'}}"
    - name: vacuum_upstairsbathroom_23_cleaned_today
      state: "{{ states('input_boolean.vacuum_upstairsbathroom_23_cleaned_today') }}"
      icon: "{{ 'mdi:checkbox-marked-circle' if is_state('input_boolean.vacuum_upstairsbathroom_23_cleaned_today', 'on') else 'mdi:checkbox-blank-circle'}}"
      