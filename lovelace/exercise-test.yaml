type: entities
view_layout:
  grid-area: exercise
card_mod:
  style: |
    ha-card {
      border-radius: 10px;
    }
title: Exercise Progress
entities:
  - type: custom:config-template-card
    variables:
      TYPE: '''run'''
      getDisplay: &getMileageDisplay |
        type => {
          var current_mileage = parseFloat(states['sensor.' + type + '_mileage_today'].state)
          var required_mileage = parseFloat(states['sensor.required_' + type + '_mileage_for_today'].state)
          if (current_mileage >= required_mileage) {
            return 'DONE! (' + current_mileage + ' miles)'
          } else {
            return current_mileage + ' / ' + required_mileage + ' miles completed'
          }
        }
    entities: &mileageEntities
      - "${'sensor.required_' + TYPE + '_mileage_for_today'}"
      - "${'sensor.' + TYPE + '_mileage_today'}"
    row: &mileageRow
      type: conditional
      conditions:
        - entity: "${'sensor.required_' + TYPE + '_mileage_for_today'}"
          state_not: '0'
      row:
        type: custom:bar-card
        entity: "${'sensor.' + TYPE + '_mileage_today'}"
        icon: "${'mdi:' + TYPE}"
        name: "${getDisplay(TYPE)}"
        min: 0
        max: "${parseFloat(states['sensor.required_' + TYPE + '_mileage_for_today'].state)}"
        entity_row: true
        positions:
          value: 'off'
        severity:
          - from: 0
            to: "${parseFloat(states['sensor.required_' + TYPE + '_mileage_for_today'].state) - 0.01}"
            color: darkred
          - from: "${parseFloat(states['sensor.required_' + TYPE + '_mileage_for_today'].state)}"
            to: "${parseFloat(states['sensor.required_' + TYPE + '_mileage_for_today'].state) + 10000000}"
            color: darkgreen
        style: &style |
          bar-card-contentbar {
            font-weight: bold;
            color: gold;
          }
          bar-card-name {
            margin-left: 10px;
          }
          bar-card-currentbar {
            border-radius: 10px;
          }
          bar-card-backgroundbar {
            border-radius: 10px;
          }

  - type: custom:config-template-card
    variables:
      TYPE: '''bike'''
      getDisplay: *getMileageDisplay
      entities: *mileageEntities
      row: *mileageRow

  - type: custom:config-template-card
    variables:
      TYPE: '''walk'''
      getDisplay: *getMileageDisplay
      entities: *mileageEntities
      row: *mileageRow