type: entities
view_layout:
  grid-area: exercise
card_mod:
  style: |
    ha-card {
      border-radius: 10px;
    }
title: Exercise Progress
entities:
  - type: conditional
    conditions:
      - entity: sensor.template_garmin_challenge_01
        state_not: 'unavailable'
    row:
      type: custom:config-template-card
      entities:
        - sensor.template_garmin_challenge_01
      variables:
        GOAL: states['sensor.template_garmin_challenge_01'].attributes.goal
        SENSOR_ENTITY: '''sensor.template_garmin_challenge_01'''
        getDisplay: &getDisplay |
          sensor_entity => {
            var state = states[sensor_entity].state
            var current_progress = states[sensor_entity].attributes.current_progress.toString().replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g, ",")
            var goal = states[sensor_entity].attributes.goal.toString().replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g, ",")
            var units = states[sensor_entity].attributes.units
            var days_remaining = Math.ceil((new Date("2021-04-30").getTime() - new Date().getTime()) / (1000*60*60*24)) + 1
            var description = states[sensor_entity].attributes.description

            var display = states[sensor_entity].attributes.friendly_name + ': '

            if (state == 'inactive') {
              display += 'Starts on ' + states[sensor_entity].attributes.start_date
            } else if (states[sensor_entity].attributes.type == 'one_time_activity') {
              if (state == 'active') {
                display += description
              } else {
                display += 'DONE! (' + description + ')'
              }
            } else {
              if (state == 'active') {
                display += current_progress + ' / ' + goal + ' ' + units
              } else {
                display += 'DONE! ' + current_progress + ' ' + units
              }
            }
            return display
          }
      row: &row
        type: custom:bar-card
        entity: "${SENSOR_ENTITY}"
        attribute: current_progress
        name: "${getDisplay(SENSOR_ENTITY)}"
        min: 0
        max: "${GOAL}"
        entity_row: true
        positions:
          value: 'off'
        severity:
          - from: 0
            to: "${GOAL - 0.01}"
            color: darkred
          - from: "${GOAL}"
            to: "${GOAL + 100000}"
            color: darkgreen
        style: |
          bar-card-contentbar {
            font-weight: bold;
            color: gold;
          }
          bar-card-name {
            margin-left: 10px;
          }
          bar-card-currentbar {
            border-radius: 10px;
          }
          bar-card-backgroundbar {
            border-radius: 10px;
          }

  - type: conditional
    conditions:
      - entity: sensor.template_garmin_challenge_02
        state_not: 'unavailable'
    row:
      type: custom:config-template-card
      entities:
        - sensor.template_garmin_challenge_02
      variables:
        GOAL: states['sensor.template_garmin_challenge_02'].attributes.goal
        SENSOR_ENTITY: '''sensor.template_garmin_challenge_02'''
        getDisplay: *getDisplay
      row: *row

  - type: conditional
    conditions:
      - entity: sensor.template_garmin_challenge_03
        state_not: 'unavailable'
    row:
      type: custom:config-template-card
      entities:
        - sensor.template_garmin_challenge_03
      variables:
        GOAL: states['sensor.template_garmin_challenge_03'].attributes.goal
        SENSOR_ENTITY: '''sensor.template_garmin_challenge_03'''
        getDisplay: *getDisplay
      row: *row
  
  - type: conditional
    conditions:
      - entity: sensor.template_garmin_challenge_04
        state_not: 'unavailable'
    row:
      type: custom:config-template-card
      entities:
        - sensor.template_garmin_challenge_04
      variables:
        GOAL: states['sensor.template_garmin_challenge_04'].attributes.goal
        SENSOR_ENTITY: '''sensor.template_garmin_challenge_04'''
        getDisplay: *getDisplay
      row: *row

  - type: conditional
    conditions:
      - entity: sensor.template_garmin_challenge_05
        state_not: 'unavailable'
    row:
      type: custom:config-template-card
      entities:
        - sensor.template_garmin_challenge_05
      variables:
        GOAL: states['sensor.template_garmin_challenge_05'].attributes.goal
        SENSOR_ENTITY: '''sensor.template_garmin_challenge_05'''
        getDisplay: *getDisplay
      row: *row

  - type: conditional
    conditions:
      - entity: sensor.template_garmin_challenge_06
        state_not: 'unavailable'
    row:
      type: custom:config-template-card
      entities:
        - sensor.template_garmin_challenge_06
      variables:
        GOAL: states['sensor.template_garmin_challenge_06'].attributes.goal
        SENSOR_ENTITY: '''sensor.template_garmin_challenge_06'''
        getDisplay: *getDisplay
      row: *row
  
  - type: conditional
    conditions:
      - entity: sensor.template_garmin_challenge_07
        state_not: 'unavailable'
    row:
      type: custom:config-template-card
      entities:
        - sensor.template_garmin_challenge_07
      variables:
        GOAL: states['sensor.template_garmin_challenge_07'].attributes.goal
        SENSOR_ENTITY: '''sensor.template_garmin_challenge_07'''
        getDisplay: *getDisplay
      row: *row

  - type: conditional
    conditions:
      - entity: sensor.template_garmin_challenge_08
        state_not: 'unavailable'
    row:
      type: custom:config-template-card
      entities:
        - sensor.template_garmin_challenge_08
      variables:
        GOAL: states['sensor.template_garmin_challenge_08'].attributes.goal
        SENSOR_ENTITY: '''sensor.template_garmin_challenge_08'''
        getDisplay: *getDisplay
      row: *row

  - type: conditional
    conditions:
      - entity: sensor.template_garmin_challenge_09
        state_not: 'unavailable'
    row:
      type: custom:config-template-card
      entities:
        - sensor.template_garmin_challenge_09
      variables:
        GOAL: states['sensor.template_garmin_challenge_09'].attributes.goal
        SENSOR_ENTITY: '''sensor.template_garmin_challenge_09'''
        getDisplay: *getDisplay
      row: *row

  - type: conditional
    conditions:
      - entity: sensor.template_garmin_challenge_10
        state_not: 'unavailable'
    row:
      type: custom:config-template-card
      entities:
        - sensor.template_garmin_challenge_10
      variables:
        GOAL: states['sensor.template_garmin_challenge_10'].attributes.goal
        SENSOR_ENTITY: '''sensor.template_garmin_challenge_10'''
        getDisplay: *getDisplay
      row: *row

  - type: conditional
    conditions:
      - entity: sensor.template_garmin_challenge_11
        state_not: 'unavailable'
    row:
      type: custom:config-template-card
      entities:
        - sensor.template_garmin_challenge_11
      variables:
        GOAL: states['sensor.template_garmin_challenge_11'].attributes.goal
        SENSOR_ENTITY: '''sensor.template_garmin_challenge_11'''
        getDisplay: *getDisplay
      row: *row

  - type: conditional
    conditions:
      - entity: sensor.template_garmin_challenge_12
        state_not: 'unavailable'
    row:
      type: custom:config-template-card
      entities:
        - sensor.template_garmin_challenge_12
      variables:
        GOAL: states['sensor.template_garmin_challenge_12'].attributes.goal
        SENSOR_ENTITY: '''sensor.template_garmin_challenge_12'''
        getDisplay: *getDisplay
      row: *row

  - type: conditional
    conditions:
      - entity: sensor.template_garmin_challenge_13
        state_not: 'unavailable'
    row:
      type: custom:config-template-card
      entities:
        - sensor.template_garmin_challenge_13
      variables:
        GOAL: states['sensor.template_garmin_challenge_13'].attributes.goal
        SENSOR_ENTITY: '''sensor.template_garmin_challenge_13'''
        getDisplay: *getDisplay
      row: *row

  - type: conditional
    conditions:
      - entity: sensor.template_garmin_challenge_14
        state_not: 'unavailable'
    row:
      type: custom:config-template-card
      entities:
        - sensor.template_garmin_challenge_14
      variables:
        GOAL: states['sensor.template_garmin_challenge_14'].attributes.goal
        SENSOR_ENTITY: '''sensor.template_garmin_challenge_14'''
        getDisplay: *getDisplay
      row: *row

  - type: conditional
    conditions:
      - entity: sensor.template_garmin_challenge_15
        state_not: 'unavailable'
    row:
      type: custom:config-template-card
      entities:
        - sensor.template_garmin_challenge_15
      variables:
        GOAL: states['sensor.template_garmin_challenge_15'].attributes.goal
        SENSOR_ENTITY: '''sensor.template_garmin_challenge_15'''
        getDisplay: *getDisplay
      row: *row