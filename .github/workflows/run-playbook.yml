name: Run Playbook
on:
  push:
    branches:
      - main
  workflow_dispatch:
jobs:
  run-playbook:
    name: Run Playbook
    runs-on: ubuntu-latest
    steps:
      - uses: Azure/login@v1
        with:
          client-id: ${{ secrets.AZURE_CLIENT_ID }}
          tenant-id: ${{ secrets.AZURE_TENANT_ID }}
          subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}
      - uses: Azure/get-keyvault-secrets@v1
        with: 
          keyvault: overlord-vault
          secrets: >
            OVERLORD-URL,
            RUN-ANSIBLE-PLAYBOOK-TOKEN
        id: az
      - run: "curl '${{ steps.az.outputs.OVERLORD-URL }}/jenkins-webhook?token=${{ steps.az.outputs.RUN-ANSIBLE-PLAYBOOK-TOKEN }}&playbook=home-assistant.yml' -X POST -d '{}'"