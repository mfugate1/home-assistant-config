script:
  hall_of_holes_add_player:
    alias: Hall of Holes - Add Player
    mode: queued
    sequence:
      - variables:
          new_name: "{{ states('input_text.hall_of_holes_add_player_name') }}"
      - service: notify.hall_of_holes_db
        data:
          message: "CREATE TABLE IF NOT EXISTS players (id INT AUTO_INCREMENT PRIMARY KEY, name VARCHAR(64))"
      - service: mysql_query.query
        response_variable: existing_players_query
        data:
          query: SELECT name FROM players
      - condition: template
        value_template: >
          {{ new_name not in (existing_players_query.result | map(attribute='player')) }}
      - service: notify.hall_of_holes_db
        data:
          message: "INSERT INTO players (name) VALUES ('{{ new_name }}')"
      - service: input_text.set_value
        entity_id: input_text.hall_of_holes_add_player_name
        data:
          value: ''

input_text:
  hall_of_holes_add_player_name:
    name: Enter new player name here